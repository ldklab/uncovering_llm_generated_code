The `jest-changed-files` package is a utility designed to identify files that have changed since the last commit, particularly for environments using Git or Mercurial (hg) for version control. It provides two main functions:

1. **`getChangedFilesForRoots`**: This function asynchronously retrieves a list of files and repositories that have changed since a particular point (e.g., the last commit). It takes two parameters:
   - `roots`: An array of string paths that define the project roots to be checked for changes.
   - `options`: An object with optional settings:
     - `lastCommit`: A boolean indicating if the changes should be checked since the last commit.
     - `withAncestor`: A boolean to include changes from ancestors.
     - `changedSince`: A string referencing a specific commit or branch to check for changes.

   It returns a Promise that resolves to an object containing:
   - `changedFiles`: A Set of changed file paths.
   - `repos`: An object with:
     - `git`: A Set of Git repository paths.
     - `hg`: A Set of Mercurial repository paths.

2. **`findRepos`**: This function finds and returns a set of repositories (both Git and Mercurial) for the specified root paths. It takes one parameter:
   - `roots`: An array of string paths representing the project roots.

   It returns a Promise that resolves to an object with:
   - `git`: A Set of Git repository paths.
   - `hg`: A Set of Mercurial repository paths.

Below is the implementation of this functionality in Node.js:

```javascript
const path = require('path');
const { exec } = require('child_process');
const util = require('util');

const execPromise = util.promisify(exec);

async function getChangedFilesForRoots(roots, options = {}) {
  let changedFiles = new Set();
  let repos = { git: new Set(), hg: new Set() };

  for (const root of roots) {
    try {
      let command;
      if (options.lastCommit) {
        command = 'git diff --name-only HEAD~1';
      } else if (options.changedSince) {
        command = `git diff --name-only ${options.changedSince}`;
      } else if (options.withAncestor) {
        command = 'git diff --name-only HEAD^';
      } else {
        continue;
      }

      const { stdout: gitOutput } = await execPromise(command, { cwd: root });
      gitOutput.split('\n').filter(Boolean).forEach(file => changedFiles.add(path.resolve(root, file)));
      repos.git.add(root);

    } catch (error) {
      // Handle git errors or unsupported vcs here
    }

    try {
      const { stdout: hgOutput } = await execPromise('hg status -mardu', { cwd: root });
      hgOutput.split('\n').filter(Boolean).forEach(line => {
        const [_, file] = line.split(' ', 2);
        if (file) changedFiles.add(path.resolve(root, file));
      });
      repos.hg.add(root);
    } catch (error) {
      // Handle hg errors or unsupported vcs here
    }
  }

  return { changedFiles, repos };
}

async function findRepos(roots) {
  const repos = { git: new Set(), hg: new Set() };

  for (const root of roots) {
    try {
      await execPromise('git rev-parse --is-inside-work-tree', { cwd: root });
      repos.git.add(root);
    } catch (error) {
      // Not a git repository
    }

    try {
      await execPromise('hg root', { cwd: root });
      repos.hg.add(root);
    } catch (error) {
      // Not an hg repository
    }
  }

  return repos;
}

module.exports = {
  getChangedFilesForRoots,
  findRepos
};
```
