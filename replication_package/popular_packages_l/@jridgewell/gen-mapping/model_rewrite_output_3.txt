The provided Node.js code defines a simple utility for generating and manipulating source maps, which are used to map a combined/minified file back to its original source files. The functionality includes the following components:

1. **`GenMapping` class**: Used to create a source map object with properties such as `file`, `sourceRoot`, `names`, `sources`, `sourcesContent`, and `mappings`.

2. **`addMapping` function**: Adds a new mapping entry to the source map, including the mapping between the generated code and the original source.

3. **`setSourceContent` function**: Sets the original source content for a given source file in the map.

4. **`toEncodedMap` function**: Generates a source map in an encoded format, consolidating mappings into a string representation.

5. **`toDecodedMap` function**: Converts the source map to a decoded format with more detail, such as the original sources and their generated mappings.

6. **`maybeAddMapping` function**: Conditionally adds a mapping only if there isn't already a mapping for the specific generated line and original line.

Below is the rewritten code with enhanced clarity and organization:

```javascript
class GenMapping {
  constructor({ file, sourceRoot } = {}) {
    this.file = file || '';
    this.sourceRoot = sourceRoot || '';
    this.names = [];
    this.sources = [];
    this.sourcesContent = [];
    this.mappings = [];
  }
}

function addMapping(map, { generated, source, original, name }) {
  if (!map.sources.includes(source)) {
    map.sources.push(source);
    map.sourcesContent.push(null);
  }
  
  if (name && !map.names.includes(name)) {
    map.names.push(name);
  }
  
  const sourceIndex = map.sources.indexOf(source);
  const nameIndex = name ? map.names.indexOf(name) : -1;
  map.mappings.push([generated, original, sourceIndex, nameIndex]);
}

function setSourceContent(map, source, content) {
  const index = map.sources.indexOf(source);
  if (index !== -1) {
    map.sourcesContent[index] = content;
  }
}

function toEncodedMap(map) {
  let encodedMappings = map.mappings.map((mapping) => {
    const [generated, original, sourceIndex, nameIndex] = mapping;
    return `${generated.line},${generated.column},${sourceIndex},${original.line},${original.column},${nameIndex};`;
  }).join('');
  
  return {
    version: 3,
    file: map.file,
    sourceRoot: map.sourceRoot,
    sources: map.sources,
    sourcesContent: map.sourcesContent,
    names: map.names,
    mappings: encodedMappings,
  };
}

function toDecodedMap(map) {
  const decodedMappings = map.mappings.map(([generated, original, sourceIndex, nameIndex]) => ({
    generated,
    source: map.sources[sourceIndex],
    original,
    name: nameIndex !== -1 ? map.names[nameIndex] : null,
  }));
  
  return {
    version: 3,
    file: map.file,
    sourceRoot: map.sourceRoot,
    sources: map.sources,
    sourcesContent: map.sourcesContent,
    names: map.names,
    mappings: decodedMappings,
  };
}

function maybeAddMapping(map, { generated, source, original, name }) {
  const duplicateExists = map.mappings.some(([gen, orig]) => 
    gen.line === generated.line && orig.line === original.line
  );
  
  if (!source || duplicateExists) return;
  addMapping(map, { generated, source, original, name });
}

// Usage example
const map = new GenMapping({ file: 'output.js', sourceRoot: 'https://example.com/' });
setSourceContent(map, 'input.js', 'function foo() {}');
addMapping(map, { generated: { line: 1, column: 0 }, source: 'input.js', original: { line: 1, column: 0 } });
addMapping(map, { generated: { line: 1, column: 9 }, source: 'input.js', original: { line: 1, column: 9 }, name: 'foo' });
console.log(toDecodedMap(map));
console.log(toEncodedMap(map));
```
This rewritten code enhances readability and structural organization while maintaining the original functionality.