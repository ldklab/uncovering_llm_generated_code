The provided Node.js code offers a simplified version of a Vite-like development environment and build process. It includes two main functionalities: a development server and a build system.

1. **Development Server (`createDevServer`)**:
   - Utilizes the `express` framework to create a server.
   - Serves JavaScript files as ES modules by setting the response type to `application/javascript`.
   - Provides a dummy endpoint `/hmr` for Hot Module Replacement (HMR), which simply returns a JSON message confirming it's been hit.
   - Serves static files from the `src` directory.
   - Operates the server on port 3000, outputting a message to indicate it's running.

2. **Build System (`buildForProduction`)**:
   - Utilizes the `esbuild` tool to bundle and minify JavaScript.
   - The build process is set up to compile the entry point `src/main.js` into a single file `dist/bundle.js` using ES module format.
   - Handles any errors in the build process by logging them to the console.

3. **Plugin System**:
   - Includes a simple demo plugin `examplePlugin` for the build process. This plugin logs a message to the console when the build starts.

Here's a rewrite of the code, maintaining its functionality:

```js
// vite/index.js

const express = require('express');
const { build } = require('esbuild');

// Function to create a development server similar to Vite
function createDevServer() {
  const app = express();

  // Middleware to ensure JavaScript files are served as ES modules
  app.get('*.js', (req, res, next) => {
    res.type('application/javascript');
    next();
  });

  // Simulated endpoint for hot module replacement feature
  app.get('/hmr', (req, res) => {
    res.json({ message: 'HMR endpoint hit!' });
  });

  // Static files are served from the 'src' directory
  app.use(express.static('src'));

  // Server listens on port 3000
  app.listen(3000, () => {
    console.log('Dev server running at http://localhost:3000');
  });
}

// Function to handle production build similar to Vite
async function buildForProduction() {
  try {
    await build({
      entryPoints: ['src/main.js'],
      bundle: true,
      minify: true,
      outfile: 'dist/bundle.js',
      format: 'esm',
      plugins: [],
    });
    console.log('Build complete!');
  } catch (error) {
    console.error('Build failed:', error);
  }
}

// Exporting functionalities for use in other modules
module.exports = {
  createDevServer,
  buildForProduction,
};

// Example plugin to demonstrate a plugin interface
function examplePlugin() {
  return {
    name: 'example-plugin',
    setup(build) {
      build.onStart(() => {
        console.log('Build started with example plugin');
      });
    },
  };
}
```