The Node.js code provided uses the `zod` library to create and validate schemas for data structures. Here's a breakdown of its functionality:

1. It imports the `z` object from the `zod` library.
2. It creates a simple string schema using `z.string()` and tests parsing a string ("hello") with it.
3. It demonstrates safe parsing with `safeParse`, which returns an object indicating success or error without throwing exceptions.
4. It creates a schema for a user object with fields for `username`, `age`, and an optional `email`. The `age` must be at least 18, and `email` must be a valid email if provided.
5. It shows usage of optional (`.optional()`) and nullable (`.nullable()`) schema definitions for strings.
6. It defines a password validation schema that requires a minimum length of 8 characters and at least one uppercase letter using `.refine()` for custom validation logic.
7. It demonstrates working with unions using `z.union()` to parse either a number or a string into a single schema.
8. It shows how to use `.transform()` to manipulate the output, specifically transforming a string into uppercase.

Rewritten code with the same functionality:

```javascript
const { z } = require('zod');

// String schema
const stringSchema = z.string();

try {
    console.log(stringSchema.parse("hello"));
} catch (e) {
    console.error(e.errors);
}

const safeParseResult = stringSchema.safeParse("hello");
if (safeParseResult.success) {
    console.log(safeParseResult.data);
} else {
    console.error(safeParseResult.error);
}

// Object schema
const userSchema = z.object({
    username: z.string(),
    age: z.number().min(18),
    email: z.string().email().optional()
});

try {
    const user = userSchema.parse({
        username: "john_doe",
        age: 20,
        email: "john@example.com"
    });
    console.log(user);
} catch (error) {
    console.error(error.errors);
}

// Optional and nullable schemas
const optionalStringSchema = z.string().optional();
console.log(optionalStringSchema.parse(undefined));

const nullableStringSchema = z.string().nullable();
console.log(nullableStringSchema.parse(null));

// Password schema with custom validation
const passwordSchema = z.string().min(8).refine(val => /[A-Z]/.test(val), {
    message: "Must contain one uppercase letter"
});

try {
    const password = passwordSchema.parse("password");
    console.log(password);
} catch (e) {
    console.error(e.errors);
}

// Unions
const numberOrString = z.union([z.number(), z.string()]);
console.log(numberOrString.parse(123));
console.log(numberOrString.parse("abc"));

// Transformations
const upperCaseString = z.string().transform(str => str.toUpperCase());
console.log(upperCaseString.parse("hello"));
```