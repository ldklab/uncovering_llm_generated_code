The Node.js code defines a module for formatting strings with ANSI escape codes for color and style in terminal output. Here's how it works:

1. **Color Support Detection:** The module checks if color support is enabled by looking at the environment variable `NO_COLOR`. If `NO_COLOR` is set, it disables color support.

2. **ANSI Wrapping Function (`wrapAnsi`):** This function wraps a given text with specified ANSI escape codes if color is supported. It takes open and close ANSI codes and the text to format.

3. **Formatter Function:** A higher-order function `formatter` is created, which uses `wrapAnsi` to apply formatting based on open and close escape codes. It returns a function that applies these codes to a text string.

4. **ANSI Escape Codes:** The module defines the ANSI escape codes for different text styles (e.g., bold, underline) and colors (e.g., red, green) in a `codes` object. This object includes modifiers, colors, and background colors with their corresponding ANSI open and close codes.

5. **Code Application Helper (`applyCodes`):** A helper function `applyCodes` takes an object of codes and returns an object where each key is mapped to a function formatting the input text with corresponding ANSI codes.

6. **Color Formatter Creation (`colors`):** The `colors` object is a comprehensive collection of formatting functions created by applying the helper to each category of ANSI codes (modifiers, colors, background colors).

7. **Color Creation Function (`createColors`):** This function returns either the full color formatting functions if enabled or it returns no-op functions that simply return the input string unchanged.

8. **Exported Module:** It exports an object containing the color formatting functions, the color support flag (`isColorSupported`), and the `createColors` function for custom setups.

Rewritten code:

```javascript
// picocolors.js
const isColorSupported = !process.env.NO_COLOR;

const wrapAnsi = (open, close, txt) => {
  return isColorSupported ? `${open}${txt}${close}` : txt;
};

const formatter = (open, close) => txt => wrapAnsi(open, close, txt);

const codes = {
  modifier: {
    reset: [0, 0],
    bold: [1, 22],
    dim: [2, 22],
    italic: [3, 23],
    underline: [4, 24],
    inverse: [7, 27],
    hidden: [8, 28],
    strikethrough: [9, 29]
  },
  color: {
    black: [30, 39],
    red: [31, 39],
    green: [32, 39],
    yellow: [33, 39],
    blue: [34, 39],
    magenta: [35, 39],
    cyan: [36, 39],
    white: [37, 39],
    blackBright: [90, 39],
    redBright: [91, 39],
    greenBright: [92, 39],
    yellowBright: [93, 39],
    blueBright: [94, 39],
    magentaBright: [95, 39],
    cyanBright: [96, 39],
    whiteBright: [97, 39]
  },
  bgColor: {
    bgBlack: [40, 49],
    bgRed: [41, 49],
    bgGreen: [42, 49],
    bgYellow: [43, 49],
    bgBlue: [44, 49],
    bgMagenta: [45, 49],
    bgCyan: [46, 49],
    bgWhite: [47, 49],
    bgBlackBright: [100, 49],
    bgRedBright: [101, 49],
    bgGreenBright: [102, 49],
    bgYellowBright: [103, 49],
    bgBlueBright: [104, 49],
    bgMagentaBright: [105, 49],
    bgCyanBright: [106, 49],
    bgWhiteBright: [107, 49]
  }
};

const applyCodes = codeObj => {
  return Object.fromEntries(
    Object.entries(codeObj)
      .map(([name, [open, close]]) => [name, formatter(`\x1b[${open}m`, `\x1b[${close}m`)])
  );
};

const colors = {
  ...applyCodes(codes.modifier),
  ...applyCodes(codes.color),
  ...applyCodes(codes.bgColor),
};

const createColors = enabled => {
  return enabled ? colors : Object.fromEntries(Object.keys(colors).map(name => [name, s => s]));
};

export default { ...colors, isColorSupported, createColors };
```