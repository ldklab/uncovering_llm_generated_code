The provided `Node.js` code demonstrates the use of the `jsdom` library for simulating a browser environment, which allows parsing and manipulating HTML in a server-side JavaScript environment. The code performs various operations using `jsdom`, such as creating a simple DOM, customizing DOM properties, enabling script execution, pretending to be a visual browser, and loading subresources with a custom resource loader.

### Functionality Breakdown:
1. **Basic JSDOM Usage**:
   - Creates a simple DOM object with a paragraph element containing the text "Hello world".
   - Logs the text content of the paragraph to the console.

2. **Customizing JSDOM**:
   - Creates a DOM with custom settings, including URL, referrer, and storage quota.
   - Logs the current URL and referrer to the console.

3. **Script Execution**:
   - Uses the option `runScripts: "dangerously"` to allow execution of scripts within the DOM.
   - Appends an `<hr>` element to a `<div>` using a script and logs the number of child elements in the `<div>`.

4. **Pretending to be a Visual Browser**:
   - Creates a DOM with the `pretendToBeVisual` option to simulate a visual browser environment.
   - Uses `requestAnimationFrame` to demonstrate visual browser capabilities and logs the timestamp.

5. **Subresource Loading with a Custom Resource Loader**:
   - Sets up a custom `ResourceLoader` with a proxy, SSL, and user-agent settings.
   - Outputs the source URL of an image in the DOM.

### Rewritten Code:

```javascript
const jsdom = require("jsdom");
const { JSDOM } = jsdom;

// Basic JSDOM Initialization
const dom = new JSDOM(`<!DOCTYPE html><p>Hello world</p>`);
console.log(dom.window.document.querySelector("p").textContent); // "Hello world"

// JSDOM with Custom Configuration
const customizedDom = new JSDOM(`<!DOCTYPE html><p>Hello world</p>`, {
  url: "https://example.org/",
  referrer: "https://example.com/",
  contentType: "text/html",
  includeNodeLocations: true,
  storageQuota: 10000000
});
console.log(customizedDom.window.location.href); // "https://example.org/"
console.log(customizedDom.window.document.referrer); // "https://example.com/"

// Execute Scripts inside JSDOM
const scriptedDom = new JSDOM(`<body>
  <div id="content"></div>
  <script>document.getElementById("content").appendChild(document.createElement("hr"));</script>
</body>`, { runScripts: "dangerously" });
console.log(scriptedDom.window.document.getElementById("content").children.length); // 1

// Simulate Visual Browser with JSDOM
const visualDom = new JSDOM(``, { pretendToBeVisual: true });
visualDom.window.requestAnimationFrame(timestamp => {
  console.log(timestamp > 0); // true
});

// Custom Resource Loader in JSDOM
const resourceLoader = new jsdom.ResourceLoader({
  proxy: "http://127.0.0.1:9001",
  strictSSL: false,
  userAgent: "Mozilla/5.0"
});
const resourceDom = new JSDOM(`<!DOCTYPE html><img src="foo.jpg">`, { resources: resourceLoader });
console.log(resourceDom.window.document.querySelector("img").src); 
```